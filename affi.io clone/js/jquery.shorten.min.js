!function(e){e.fn.shorten=function(s){"use strict";var t={showChars:100,minHideChars:10,ellipsesText:"...",moreText:"more",lessText:"less",errMsg:null,force:!1};return s&&e.extend(t,s),!(e(this).data("jquery.shorten")&&!t.force)&&(e(this).data("jquery.shorten",!0),e(document).off("click",".morelink"),e(document).on({click:function(){var s=e(this);return s.hasClass("less")?(s.removeClass("less"),s.html(t.moreText),s.parent().prev().prev().show(),s.parent().prev().hide()):(s.addClass("less"),s.html(t.lessText),s.parent().prev().prev().hide(),s.parent().prev().show()),!1}},".morelink"),this.each(function(){var s=e(this),r=s.html();if(s.text().length>t.showChars+t.minHideChars){var n=r.substr(0,t.showChars);if(n.indexOf("<")>=0){for(var l=!1,a="",h=0,o=[],i=null,c=0,f=0;f<=t.showChars;c++)if("<"!=r[c]||l||(l=!0,"/"==(i=r.substring(c+1,r.indexOf(">",c)))[0]?i!="/"+o[0]?t.errMsg="ERROR en HTML: the top of the stack should be the tag that closes":o.shift():"br"!=i.toLowerCase()&&o.unshift(i)),l&&">"==r[c]&&(l=!1),l)a+=r.charAt(c);else if(f++,h<=t.showChars)a+=r.charAt(c),h++;else if(o.length>0){for(j=0;j<o.length;j++)a+="</"+o[j]+">";break}n=e("<div/>").html(a+'<span class="ellip">'+t.ellipsesText+"</span>").html()}else n+=t.ellipsesText;var d='<div class="shortcontent">'+n+'</div><div class="allcontent">'+r+'</div><span><a href="#" class="morelink">'+t.moreText+"</a></span>";s.html(d),s.find(".allcontent").hide(),e(".shortcontent p:last",s).css("margin-bottom",0)}}))}}(jQuery);